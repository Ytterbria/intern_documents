sentinel 是redis提供的高可用解决方案
用于监控redis主从集群,自动完成主从切换,实现故障自动恢复和通知.

* 主要功能
监控:  哨兵不断监控Redis的主节点和从节点的运行状态,定期ping请求,检查节点是否正常
自动故障转移: 如果主节点发生故障时,哨兵会选举一个从节点提升为新的主节点,并通知客户端更新主节点地址,从而实现高可用
通知: 哨兵可以向运维或其他服务发送通知,以便快速处理redis实例的变化

*主观下线和客观下线
如果是由于网络抖动等问题导致了某一台哨兵没有ping到主节点,
那么它就会被这个sentinel主观认为下线了,导致误判. 因此还需要向其他哨兵发起投票
如果认为它下线的总投票数大于 quorum(集群总数 / 2 + 1), 那么就判定这个主节点客观下线. 而且只有哨兵的leader才能操作主从切换

*哨兵的leader 时如何选出来的 ? raft协议
判断主节点主观下线的sentinel就是候选者,他们会一起竞争,当获得了哨兵集群半数以上的投票后, 它就会成为leader. 所以为了防止平票,一般部署sentinel节点个数为奇数

成为leader后的哨兵,开始选择新的master节点, 选择原则有以下三个流程
1.根据从节点的优先级, slave-priority配置, 这个值越小,优先级越高
2.如果优先级相同,则根据查看进行主从同步的offset进度, offset越大
则说明其同步的数据越多,越新,则优先选择它
3.如果offset也相同,则选择ID号较小的作为主节点. 
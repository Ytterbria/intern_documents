Use Caseï¼šç”¨æˆ·ä¸Šä¼ æ–‡ä»¶ â†’ æé—®é¢˜ â†’ Agent ç”Ÿæˆåˆ†æè®¡åˆ’ â†’ ç”¨æˆ·ç¡®è®¤å¹¶è¿è¡Œ â†’ è‡ªåŠ¨æ‰§è¡Œä»£ç  â†’ ä¿®æ­£é”™è¯¯ â†’ å¾—åˆ°ç»“æœã€‚
Main Processï¼š
ç”¨æˆ·ä¸Šä¼  CSV â†’ å­˜åœ¨ Shared Driveï¼Œå¯ä»¥ç›´æ¥æ‹¿åˆ° s3 pathã€‚
åˆå§‹åŒ–æ—¶ï¼ŒAgent è¯»å– CSV â†’ è½¬æ¢æˆ DataFrame â†’ ç¼“å­˜åœ¨ Redisã€‚
æ¯æ¬¡ Notebook cell æ‰§è¡Œå®Œåï¼Œéƒ½ä¼šæŠŠ DataFrame ä¿¡æ¯ä¸ŠæŠ¥åˆ° Redisã€‚ åç»­æ­¥éª¤ä¾èµ–æœ€æ–°çš„ DataFrame ä¿¡æ¯ï¼ŒAgent æ ¹æ®ä¸Šä¸‹æ–‡è‡ªåŠ¨ç”Ÿæˆæ–°çš„ä»£ç ã€‚

Conversation Managementï¼ˆå¯¹è¯ç®¡ç†ï¼‰
æ¯ä¸ª Notebook kernel å¯¹åº”ä¸€ä¸ª conversationã€‚
ç”¨æˆ·ä¸ Copilot çš„æ¯æ¬¡äº¤äº’ã€ç‚¹å‡» accept and runã€ç³»ç»Ÿè‡ªåŠ¨æ‰§è¡Œæ­¥éª¤ï¼Œç»Ÿç»Ÿç®—ä½œ messageã€‚
æ‰€æœ‰å¯¹è¯å’Œæ¶ˆæ¯éƒ½å­˜æ•°æ®åº“ï¼ˆMySQLï¼‰ï¼š
conversation_tabï¼šå­˜ä¼šè¯æ•´ä½“ä¿¡æ¯ï¼ˆkernel_idã€project_codeã€statusã€ç”¨æˆ·è´¦å·ã€åˆ›å»ºæ—¶é—´â€¦ï¼‰ã€‚
message_tabï¼šå­˜æ¯æ¡æ¶ˆæ¯ï¼ˆå±äºå“ªä¸ª conversationï¼Œæ¶ˆæ¯è§’è‰²ï¼šuser/system/assistantï¼Œå†…å®¹ï¼Œæ˜¯å¦å¯è§ï¼Œæ‰©å±•å­—æ®µå¦‚ s3 key ç­‰ï¼‰ã€‚
ğŸ‘‰ æ„ä¹‰ï¼š
è¿™æ˜¯ä¸ºäº† æŒä¹…åŒ–æ‰€æœ‰äº¤äº’è¿‡ç¨‹ï¼Œæ—¢æ–¹ä¾¿å›æº¯ï¼Œåˆèƒ½ç”¨äºè®­ç»ƒå’Œä¼˜åŒ–ã€‚

conversationè¡¨
CREATE TABLE `conversation_tab` (
  `id` bigint(20) NOT NULL AUTO_INCREMENT COMMENT 'primary key',
  `kernel_id` varchar(128) NOT NULL DEFAULT '' COMMENT 'kernel id',
  `asset_id` bigint(20) NOT NULL DEFAULT '0' COMMENT 'asset id of notebook', æ”¾åˆ°extend_field
  `project_code` varchar(256) NOT NULL COMMENT 'project code',
  `conversation_type` varchar(64) NOT NULL DEFAULT '' COMMENT 'scenario type of conversation',
  `conversation_status` tinyint(4) NOT NULL DEFAULT '1' COMMENT '1-active 0-inactive',
  `extend_field` text COMMENT 'extend filed, json string',
  `create_by` varchar(255) NOT NULL DEFAULT '' COMMENT 'user hadoop account',
  `create_time` bigint(20) NOT NULL DEFAULT '0' COMMENT 'timestamp in millis',
  `update_time` bigint(20) NOT NULL DEFAULT '0' COMMENT 'timestamp in millis',
  PRIMARY KEY (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;

messageè¡¨
CREATE TABLE `message_tab` (
  `id` bigint(20) NOT NULL AUTO_INCREMENT COMMENT 'primary key',
  `conversation_id` bigint(20) NOT NULL COMMENT 'primary key of conversation', 
  `role` varchar(64) NOT NULL DEFAULT 'user' COMMENT 'role of message sender, user/system/assistant ç­‰',
  `content` text NOT NULL COMMENT 'message detail', -- é•¿åº¦å¯èƒ½ä¸å¤Ÿ è€ƒè™‘ç”¨MEDIUMTEXT
  `visibility` tinyint(4) DEFAULT '0' COMMENT 'user visibility, 0-hidden, 1-show',
  `extend_field` text COMMENT 'extend filed, json string, like s3 key of csv file',
  `create_by` varchar(255) NOT NULL DEFAULT '' COMMENT 'user hadoop account',
  `create_time` bigint(20) NOT NULL DEFAULT '0' COMMENT 'timestamp in millis',
  PRIMARY KEY (`id`),
  KEY `idx_conversation_id` (`conversation_id`),
  KEY `idx_create_time` (`create_time`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;


Generate Execution Plan
ç”Ÿæˆexecution planè¿™éƒ¨åˆ†å®é™…ä¸Šæ˜¯ä¸€ä¸ªdata analysis agentçš„é€šç”¨chatæ¥å£ï¼Œç”¨æˆ·å¯ä»¥é€šè¿‡messageæ¥ç”Ÿæˆplanã€ä¿®æ”¹planï¼Œåç»­å¯èƒ½éœ€è¦æ”¯æŒå¯¹å·²æœ‰dataframeé€šè¿‡messageè¿›è¡Œå¤„ç†çš„ä»£ç ç”Ÿæˆã€‚

è€Œåœ¨ç”¨æˆ·accept and runçš„æ—¶å€™ï¼Œå¯ä»¥ä½¿ç”¨ä¸“é—¨çš„æ¥å£é€šè¿‡å‰åç«¯çš„é…åˆæ¥æ‰§è¡Œplanä¸­çš„æ¯ä¸€æ­¥ï¼ŒåŒ…æ‹¬å¯¹æ‰§è¡Œé”™è¯¯æ­¥éª¤çš„ä¿®æ­£ã€‚æ‰€ä»¥è¿™é‡Œå¯ä»¥åˆ†å¼€æ¥çœ‹è¿™å‡ ä¸ªæ¥å£ï¼Œå…ˆçœ‹ä¸‹agentçš„chatæ¥å£ï¼š
åˆå§‹åŒ–dataframeæ—¶è¯»ä¸€æ¬¡csvæ–‡ä»¶ï¼Œå­˜åˆ°Redisï¼Œkeyï¼šå›ºå®šå‰ç¼€+conversation_id+ s3 file path, åé¢ç”¨æˆ·è¿è¡Œcellä¼šä¸ŠæŠ¥kernel df(redis key: kernel_id)ï¼Œåé¢æ­¥éª¤å°±è¯»å–kernel dataframe 
ç”Ÿæˆçš„execution planå­˜å‚¨åˆ°Redisï¼Œkey: planId, å¹¶ä¸”ä¿è¯åŒä¸€ä¸ªkernelä¸­åŒä¸€ä¸ªæ–‡ä»¶åªæœ‰ä¸€ä¸ªexecution plan. ç”Ÿæˆå”¯ä¸€çš„plan_id( å›ºå®šå‰ç¼€+conversation_id+ s3 file path è¿›è¡Œ base64 encode)ï¼Œæ˜ å°„å…³ç³»æ”¾Redis

ç”¨æˆ·åœ¨è¿è¡Œç¬¬ä¸€æ­¥ï¼Œæˆ–è€…è¯´æ˜¯load dataframeä¹‹å‰çš„æ­¥éª¤æ—¶ï¼Œåå°è·å–ä¹‹å‰ä¸Šä¼ æ—¶å­˜ä¸‹æ¥çš„df infoï¼Œå¦‚æœæ˜¯åç»­æ­¥éª¤åˆ™ä½¿ç”¨cellæ‰§è¡Œåæ‰€ä¸ŠæŠ¥çš„dfä¿¡æ¯
cellè¿è¡Œå¤±è´¥å‰ç«¯è‡ªåŠ¨è°ƒç”¨re-generate codeç»§ç»­æ‰§è¡Œï¼Œä½†é‡è¯•æ¬¡æ•°éœ€è¦é™åˆ¶ 3æ¬¡

Cancel / Stop Execute Plan
ç›´æ¥ä½¿ç”¨ä¸Šè¿°çš„update status of stepæ¥å£å³å¯ï¼Œæ›´æ–°å½“å‰stepä¸ºcancel
ä¸€ä¸ªconversationä¸­ä¸€ä¸ªæ–‡ä»¶åªä¼šå¯¹åº”ä¸€ä¸ªplanï¼Œé€šè¿‡æ–‡ä»¶s3path ç”Ÿæˆä¸€ä¸ªplan_idä½œä¸ºRedisçš„keyå­˜å‚¨planï¼Œ stopæˆ–è€…å–æ¶ˆä¸ä¼šå½±å“plan_idçš„å€¼ï¼Œåç»­è¯¥conversationä¸­ç›¸åŒæ–‡ä»¶ç”Ÿæˆçš„planä¼šè¦†ç›–åŸæœ‰çš„ã€‚

